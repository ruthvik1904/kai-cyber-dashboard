/**
 * Individual vulnerability card component
 */

import { Box, Badge, Text, VStack, HStack, Link } from '@chakra-ui/react';
import { memo } from 'react';
import { FlattenedVulnerability } from '../../types/vulnerability';

interface VulnerabilityCardProps {
  vulnerability: FlattenedVulnerability;
  onClick?: () => void;
}

const severityColors: Record<string, string> = {
  critical: 'red',
  high: 'orange',
  medium: 'yellow',
  low: 'green',
};

function VulnerabilityCard({ vulnerability, onClick }: VulnerabilityCardProps) {
  const severityColor = severityColors[vulnerability.severity.toLowerCase()] || 'gray';

  return (
    <Box
      p={4}
      borderWidth="1px"
      borderRadius="md"
      bg="white"
      cursor={onClick ? 'pointer' : 'default'}
      onClick={onClick}
      _hover={onClick ? { shadow: 'md', transform: 'translateY(-2px)' } : {}}
      transition="all 0.2s"
    >
      <VStack align="stretch" spacing={3}>
        <HStack justify="space-between" align="start">
          <VStack align="start" spacing={1} flex={1}>
            <Text fontWeight="bold" fontSize="lg" color="blue.600">
              {vulnerability.cve}
            </Text>
            <Text fontSize="sm" color="gray.600">
              {vulnerability.packageName} @ {vulnerability.packageVersion}
            </Text>
          </VStack>
          <VStack align="end" spacing={2}>
            <Badge colorScheme={severityColor} fontSize="sm">
              {vulnerability.severity.toUpperCase()}
            </Badge>
            <Badge colorScheme="blue" fontSize="sm">
              CVSS: {vulnerability.cvss.toFixed(1)}
            </Badge>
          </VStack>
        </HStack>

        <Text fontSize="sm" color="gray.700" noOfLines={2}>
          {vulnerability.description}
        </Text>

        <HStack fontSize="xs" color="gray.500" spacing={4}>
          <Text>Published: {new Date(vulnerability.published).toLocaleDateString()}</Text>
          {vulnerability.kaiStatus && (
            <Badge size="sm" variant="outline">
              {vulnerability.kaiStatus}
            </Badge>
          )}
          {vulnerability.link && (
            <Link href={vulnerability.link} isExternal color="blue.500">
              View Details
            </Link>
          )}
        </HStack>
      </VStack>
    </Box>
  );
}

export default memo(VulnerabilityCard);

