import { SimpleGrid, Box, Text, Stat, StatLabel, StatNumber } from '@chakra-ui/react';
import { FlattenedVulnerability } from '../../types/vulnerability';

interface VulnerabilityMetadataGridProps {
  vulnerability: FlattenedVulnerability;
}

function MetadataItem({ label, value }: { label: string; value?: string }) {
  if (!value) return null;
  return (
    <Box bg="gray.50" p={4} borderRadius="md">
      <Text fontSize="sm" color="gray.500" mb={1}>
        {label}
      </Text>
      <Text fontWeight="medium" color="gray.800" wordBreak="break-word">
        {value}
      </Text>
    </Box>
  );
}

export default function VulnerabilityMetadataGrid({ vulnerability }: VulnerabilityMetadataGridProps) {
  return (
    <SimpleGrid columns={{ base: 1, md: 2, lg: 3 }} spacing={4}>
      <Stat bg="gray.50" p={4} borderRadius="md">
        <StatLabel>CVSS Score</StatLabel>
        <StatNumber>{vulnerability.cvss.toFixed(1)}</StatNumber>
      </Stat>
      <MetadataItem label="Status" value={vulnerability.status} />
      <MetadataItem label="Owner" value={vulnerability.owner} />
      <MetadataItem label="Published" value={new Date(vulnerability.published).toLocaleString()} />
      <MetadataItem label="Fix Date" value={vulnerability.fixDate ? new Date(vulnerability.fixDate).toLocaleString() : undefined} />
      <MetadataItem label="Image" value={`${vulnerability.imageName}:${vulnerability.imageVersion}`} />
      <MetadataItem label="Repository" value={vulnerability.repoName} />
      <MetadataItem label="Group" value={vulnerability.groupName} />
      <MetadataItem label="Applicable Rules" value={vulnerability.applicableRules?.join(', ') || undefined} />
      <MetadataItem label="Path" value={vulnerability.path} />
    </SimpleGrid>
  );
}
