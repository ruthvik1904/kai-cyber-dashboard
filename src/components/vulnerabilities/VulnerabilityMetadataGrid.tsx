import { SimpleGrid, Box, Text, Stat, StatLabel, StatNumber, useColorModeValue } from '@chakra-ui/react';
import { FlattenedVulnerability } from '../../types/vulnerability';

interface VulnerabilityMetadataGridProps {
  vulnerability: FlattenedVulnerability;
}

export default function VulnerabilityMetadataGrid({ vulnerability }: VulnerabilityMetadataGridProps) {
  const cardBg = useColorModeValue('gray.50', 'gray.700');
  const statBg = useColorModeValue('blue.50', 'rgba(59, 130, 246, 0.16)');
  const labelColor = useColorModeValue('gray.600', 'gray.300');
  const valueColor = useColorModeValue('gray.800', 'gray.100');
  const statLabelColor = useColorModeValue('gray.600', 'gray.300');
  const statNumberColor = useColorModeValue('blue.600', 'blue.200');
  const cardBorder = useColorModeValue('gray.200', 'gray.600');
  const statBorder = useColorModeValue('blue.100', 'blue.400');

  const MetadataItem = ({ label, value }: { label: string; value?: string }) => {
    if (!value) return null;
    return (
      <Box bg={cardBg} p={4} borderRadius="md" borderWidth="1px" borderColor={cardBorder}>
        <Text fontSize="sm" color={labelColor} mb={1}>
          {label}
        </Text>
        <Text fontWeight="medium" color={valueColor} wordBreak="break-word">
          {value}
        </Text>
      </Box>
    );
  };

  return (
    <SimpleGrid columns={{ base: 1, md: 2, lg: 3 }} spacing={4}>
      <Stat bg={statBg} p={4} borderRadius="md" borderWidth="1px" borderColor={statBorder}>
        <StatLabel color={statLabelColor}>CVSS Score</StatLabel>
        <StatNumber color={statNumberColor}>{vulnerability.cvss.toFixed(1)}</StatNumber>
      </Stat>
      <MetadataItem label="Status" value={vulnerability.status} />
      <MetadataItem label="Owner" value={vulnerability.owner} />
      <MetadataItem label="Published" value={new Date(vulnerability.published).toLocaleString()} />
      <MetadataItem label="Fix Date" value={vulnerability.fixDate ? new Date(vulnerability.fixDate).toLocaleString() : undefined} />
      <MetadataItem label="Image" value={`${vulnerability.imageName}:${vulnerability.imageVersion}`} />
      <MetadataItem label="Repository" value={vulnerability.repoName} />
      <MetadataItem label="Group" value={vulnerability.groupName} />
      <MetadataItem label="Applicable Rules" value={vulnerability.applicableRules?.join(', ') || undefined} />
      <MetadataItem label="Path" value={vulnerability.path} />
    </SimpleGrid>
  );
}
