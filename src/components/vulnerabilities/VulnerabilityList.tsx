/**
 * Virtual scrolling vulnerability list component
 */

import { Box, Text, Center } from '@chakra-ui/react';
import { FixedSizeList as List } from 'react-window';
import { memo } from 'react';
import VulnerabilityCard from './VulnerabilityCard';
import { FlattenedVulnerability } from '../../types/vulnerability';

interface VulnerabilityListProps {
  vulnerabilities: FlattenedVulnerability[];
  height?: number;
  itemHeight?: number;
  isSelected: (cveId: string) => boolean;
  onToggleSelect: (cveId: string) => void;
}

// Estimate card height (will be adjusted based on actual content)
const ESTIMATED_CARD_HEIGHT = 180;
const CARD_PADDING = 8;

function VulnerabilityList({
  vulnerabilities,
  height = 600,
  itemHeight = ESTIMATED_CARD_HEIGHT + CARD_PADDING,
  isSelected,
  onToggleSelect,
}: VulnerabilityListProps) {
  // Row renderer component
  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => {
    const vulnerability = vulnerabilities[index];
    if (!vulnerability) return null;

    return (
      <div style={{ ...style, padding: `${CARD_PADDING}px` }}>
        <VulnerabilityCard
          vulnerability={vulnerability}
          isSelected={isSelected(vulnerability.cve)}
          onToggleSelect={onToggleSelect}
        />
      </div>
    );
  };

  if (vulnerabilities.length === 0) {
    return (
      <Center py={12}>
        <Text color="gray.500">No vulnerabilities found.</Text>
      </Center>
    );
  }

  return (
    <Box>
      <List
        height={height}
        itemCount={vulnerabilities.length}
        itemSize={itemHeight}
        itemKey={(index) =>
          vulnerabilities[index]?.cve
            ? vulnerabilities[index].cve + index.toString()
            : index.toString()
        }
        width="100%"
      >
        {Row}
      </List>
    </Box>
  );
}

export default memo(VulnerabilityList);

