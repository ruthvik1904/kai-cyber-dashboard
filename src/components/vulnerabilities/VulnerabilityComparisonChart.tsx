import { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, LabelList, Cell } from 'recharts';
import { Box, Text } from '@chakra-ui/react';
import { FlattenedVulnerability } from '../../types/vulnerability';

interface VulnerabilityComparisonChartProps {
  vulnerabilities: FlattenedVulnerability[];
}

const severityColorMap: Record<string, string> = {
  critical: '#DC2626',
  high: '#EA580C',
  medium: '#D97706',
  low: '#16A34A',
};

export default function VulnerabilityComparisonChart({ vulnerabilities }: VulnerabilityComparisonChartProps) {
  if (vulnerabilities.length === 0) {
    return null;
  }

  const data = vulnerabilities.map((vuln) => ({
    name: vuln.cve,
    cvss: vuln.cvss,
    fill: severityColorMap[vuln.severity.toLowerCase()] || '#3B82F6',
  }));

  return (
    <Box>
      <Text fontWeight="bold" mb={2}>
        CVSS Score Comparison
      </Text>
      <Box h={250}>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} margin={{ top: 10, right: 20, left: 0, bottom: 40 }}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="name" angle={-35} textAnchor="end" height={80} interval={0} tick={{ fontSize: 12 }} />
            <YAxis domain={[0, 10]} tick={{ fontSize: 12 }} />
            <Tooltip formatter={(value: number) => value.toFixed(1)} />
            <Bar dataKey="cvss" radius={[4, 4, 0, 0]}>
              <LabelList dataKey="cvss" position="top" formatter={(value: number) => value.toFixed(1)} />
              {data.map((entry) => (
                <Cell key={`cell-${entry.name}`} fill={entry.fill} />
              ))}
            </Bar>
          </BarChart>
        </ResponsiveContainer>
      </Box>
    </Box>
  );
}
