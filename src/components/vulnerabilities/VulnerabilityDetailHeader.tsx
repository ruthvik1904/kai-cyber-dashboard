import { HStack, VStack, Heading, Badge, Button, IconButton, Text, Spacer } from '@chakra-ui/react';
import { ArrowBackIcon, ExternalLinkIcon } from '@chakra-ui/icons';
import { useNavigate } from 'react-router-dom';
import { FlattenedVulnerability } from '../../types/vulnerability';

const severityColorMap: Record<string, string> = {
  critical: 'red',
  high: 'orange',
  medium: 'yellow',
  low: 'green',
};

interface VulnerabilityDetailHeaderProps {
  vulnerability: FlattenedVulnerability;
}

export default function VulnerabilityDetailHeader({ vulnerability }: VulnerabilityDetailHeaderProps) {
  const navigate = useNavigate();
  const severityColor = severityColorMap[vulnerability.severity.toLowerCase()] || 'gray';

  return (
    <HStack align="start" spacing={6} wrap="wrap">
      <IconButton
        aria-label="Back to list"
        icon={<ArrowBackIcon />}
        onClick={() => navigate(-1)}
        variant="ghost"
      />
      <VStack align="start" spacing={2} flex={1} minW="0">
        <HStack spacing={3} align="center">
          <Heading size="lg" wordBreak="break-word">
            {vulnerability.cve}
          </Heading>
          <Badge colorScheme={severityColor} fontSize="sm">
            {vulnerability.severity.toUpperCase()}
          </Badge>
          <Badge colorScheme="blue" fontSize="sm">
            CVSS: {vulnerability.cvss.toFixed(1)}
          </Badge>
          {vulnerability.kaiStatus && (
            <Badge colorScheme="purple" fontSize="sm">
              {vulnerability.kaiStatus}
            </Badge>
          )}
        </HStack>
        <Text color="gray.600" noOfLines={2} maxW="3xl">
          {vulnerability.description}
        </Text>
        <HStack spacing={3} color="gray.500" fontSize="sm">
          <Text>
            Package: {vulnerability.packageName} @ {vulnerability.packageVersion}
          </Text>
          <Text>Type: {vulnerability.packageType}</Text>
        </HStack>
      </VStack>
      <Spacer />
      {vulnerability.link && (
        <Button
          as="a"
          href={vulnerability.link}
          target="_blank"
          rel="noopener noreferrer"
          rightIcon={<ExternalLinkIcon />}
          colorScheme="blue"
        >
          View on NVD
        </Button>
      )}
    </HStack>
  );
}
