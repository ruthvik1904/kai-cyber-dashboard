/**
 * Vulnerability listing page
 * Shows filtered list of vulnerabilities with Analysis buttons
 */

import {
  Box,
  Heading,
  Text,
  VStack,
  HStack,
  Button,
  Badge,
  Alert,
  AlertIcon,
} from '@chakra-ui/react';
import { useVulnerabilityFilters } from '../hooks/useVulnerabilityFilters';

function VulnerabilityList() {
  const {
    filteredData,
    filterStats,
    applyAnalysis,
    applyAIAnalysis,
    clearFilters,
    isLoading,
    filters,
  } = useVulnerabilityFilters();

  return (
    <VStack align="stretch" spacing={6}>
      <Box>
        <Heading size="xl" mb={2}>
          Vulnerability List
        </Heading>
        <Text color="gray.600">
          Browse and filter security vulnerabilities
        </Text>
      </Box>

      {/* Analysis Buttons */}
      <Box bg="white" p={6} borderRadius="lg" shadow="md">
        <Heading size="md" mb={4}>
          Analysis Tools
        </Heading>
        <HStack spacing={4} mb={4}>
          <Button
            colorScheme="blue"
            onClick={applyAnalysis}
            isDisabled={isLoading}
          >
            Analysis
          </Button>
          <Button
            colorScheme="purple"
            onClick={applyAIAnalysis}
            isDisabled={isLoading}
          >
            AI Analysis
          </Button>
          {(filters.excludeKaiStatus?.length ?? 0) > 0 && (
            <Button variant="outline" onClick={clearFilters}>
              Clear Filters
            </Button>
          )}
        </HStack>
        <Text fontSize="sm" color="gray.600">
          Analysis: Filters out CVEs with kaiStatus "invalid - norisk"
          <br />
          AI Analysis: Filters out CVEs with kaiStatus "ai-invalid-norisk"
        </Text>
      </Box>

      {/* Filter Stats */}
      <Box bg="white" p={4} borderRadius="lg" shadow="md">
        <HStack spacing={6}>
          <Box>
            <Text fontSize="sm" color="gray.600">
              Total Vulnerabilities
            </Text>
            <Text fontSize="2xl" fontWeight="bold">
              {filterStats.total.toLocaleString()}
            </Text>
          </Box>
          <Box>
            <Text fontSize="sm" color="gray.600">
              Filtered Results
            </Text>
            <Text fontSize="2xl" fontWeight="bold" color="blue.600">
              {filterStats.filtered.toLocaleString()}
            </Text>
          </Box>
          {filterStats.excluded > 0 && (
            <Box>
              <Text fontSize="sm" color="gray.600">
                Excluded
              </Text>
              <Text fontSize="2xl" fontWeight="bold" color="orange.600">
                {filterStats.excluded.toLocaleString()}
              </Text>
            </Box>
          )}
        </HStack>
      </Box>

      {/* Active Filters */}
      {(filters.excludeKaiStatus?.length ?? 0) > 0 && (
        <Alert status="info">
          <AlertIcon />
          <Box>
            <Text fontWeight="bold">Active Filters:</Text>
            <HStack mt={2} spacing={2}>
              {filters.excludeKaiStatus?.map((status) => (
                <Badge key={status} colorScheme="blue">
                  Excluding: {status}
                </Badge>
              ))}
            </HStack>
          </Box>
        </Alert>
      )}

      {/* Vulnerability List - Placeholder for Phase 3 */}
      <Box bg="white" p={6} borderRadius="lg" shadow="md">
        <Heading size="md" mb={4}>
          Vulnerabilities ({filteredData.length.toLocaleString()})
        </Heading>
        {isLoading ? (
          <Text>Loading vulnerabilities...</Text>
        ) : filteredData.length === 0 ? (
          <Text color="gray.500">No vulnerabilities found.</Text>
        ) : (
          <Text color="gray.500">
            Vulnerability list with virtual scrolling will be added in Phase 3
          </Text>
        )}
      </Box>
    </VStack>
  );
}

export default VulnerabilityList;

